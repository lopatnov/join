{"version":3,"file":"join.js","sources":["../src/join.ts"],"sourcesContent":["/**\n * Join Types\n */\nexport enum JoinTypes {\n  none = 0b0000,\n  left = 0b1000,\n  right = 0b0001,\n  innerLeft = 0b0100,\n  innerRight = 0b0010,\n  innerJoin = none | innerLeft | innerRight | none,\n  leftJoin =  left | innerLeft | innerRight | none,\n  rightJoin = none | innerLeft | innerRight | right,\n  fullJoin =  left | innerLeft | innerRight | right,\n  expand =    left | none      | innerRight | right\n}\n\nfunction getPartNames(left: any, right: any) {\n  let namesLeft = Object.getOwnPropertyNames(left);\n  let namesRight = Object.getOwnPropertyNames(right);\n  let namesMid = namesLeft.filter(x => namesRight.indexOf(x) > -1);\n  namesLeft = namesLeft.filter(x => namesMid.indexOf(x) < 0);\n  namesRight = namesRight.filter(x => namesMid.indexOf(x) < 0);\n  return {\n    left: namesLeft,\n    middle: namesMid,\n    right: namesRight\n  };\n}\n\nfunction clearNames(obj: any, names: string[]) {\n  for (let i = 0; i < names.length; i++) {\n    delete obj[names[i]];\n  }\n}\n\nfunction attach(toObj: any, attachment: any, names: string[]) {\n  if (toObj === attachment) return;\n\n  for (let i = 0; i < names.length; i++) {\n    let descriptor = Object.getOwnPropertyDescriptor(attachment, names[i]);\n    Object.defineProperty(toObj, names[i], descriptor as PropertyDescriptor);\n  }\n}\n\nfunction isFunction(obj: any) {\n  // Support: Chrome <=57, Firefox <=52\n  // In some browsers, typeof returns \"function\" for HTML <object> elements\n  // (i.e., `typeof document.createElement( \"object\" ) === \"function\"`).\n  // We don't want to classify *any* DOM node as a function.\n  return typeof obj === \"function\" && typeof obj.nodeType !== \"number\";\n}\n\nfunction isPlainObject(obj: any) {\n  var proto, Ctor;\n  let toString = Object.prototype.toString;\n  let getProto = Object.getPrototypeOf;\n  let hasOwn = Object.prototype.hasOwnProperty;\n  var fnToString = hasOwn.toString;\n  var ObjectFunctionString = fnToString.call(Object);\n\n  // Detect obvious negatives\n  // Use toString instead of type to catch host objects\n  if (!obj || toString.call(obj) !== \"[object Object]\") {\n    return false;\n  }\n\n  proto = getProto(obj);\n\n  // Objects with no prototype (e.g., `Object.create( null )`) are plain\n  if (!proto) {\n    return true;\n  }\n\n  // Objects with prototype are plain iff they were constructed by a global Object function\n  Ctor = hasOwn.call(proto, \"constructor\") && proto.constructor;\n  return (\n    typeof Ctor === \"function\" && fnToString.call(Ctor) === ObjectFunctionString\n  );\n}\n\nfunction extend(...args: any[]) {\n  var options,\n    name,\n    src,\n    copy,\n    copyIsArray,\n    clone,\n    target = arguments[0] || {},\n    i = 1,\n    length = arguments.length,\n    deep = false;\n\n  // Handle a deep copy situation\n  if (typeof target === \"boolean\") {\n    deep = target;\n\n    // Skip the boolean and the target\n    target = arguments[i] || {};\n    i++;\n  }\n\n  // Handle case when target is a string or something (possible in deep copy)\n  if (typeof target !== \"object\" && !isFunction(target)) {\n    target = {};\n  }\n\n  // Extend itself if only one argument is passed\n  if (i === length) {\n    target = {};\n    i--;\n  }\n\n  for (; i < length; i++) {\n    // Only deal with non-null/undefined values\n    if ((options = arguments[i]) != null) {\n      // Extend the base object\n      for (name in options) {\n        copy = options[name];\n\n        // Prevent Object.prototype pollution\n        // Prevent never-ending loop\n        if (name === \"__proto__\" || target === copy) {\n          continue;\n        }\n\n        // Recurse if we're merging plain objects or arrays\n        if (\n          deep &&\n          copy &&\n          (isPlainObject(copy) || (copyIsArray = Array.isArray(copy)))\n        ) {\n          src = target[name];\n\n          // Ensure proper type for the source value\n          if (copyIsArray && !Array.isArray(src)) {\n            clone = [];\n          } else if (!copyIsArray && !isPlainObject(src)) {\n            clone = {};\n          } else {\n            clone = src;\n          }\n          copyIsArray = false;\n\n          // Never move original objects, clone them\n          target[name] = extend(deep, clone, copy);\n\n          // Don't bring in undefined values\n        } else if (copy !== undefined) {\n          target[name] = copy;\n        }\n      }\n    }\n  }\n\n  // Return the modified object\n  return target;\n}\n\nfunction mergeObjects(left: any, right: any, names: string[]) {\n  if (left === right) return;\n  for (let i = 0; i < names.length; i++) {\n    if (\n      right[names[i]] === null ||\n      [\n        \"string\",\n        \"boolean\",\n        \"null\",\n        \"undefined\",\n        \"symbol\",\n        \"number\",\n        \"bigint\",\n        \"regexp\"\n      ].indexOf((typeof right[names[i]]).toLowerCase()) > -1\n    ) {\n      let descriptor = Object.getOwnPropertyDescriptor(right, names[i]);\n      Object.defineProperty(left, names[i], descriptor as PropertyDescriptor);\n    } else {\n      left[names[i]] = extend(true, left[names[i]], right[names[i]]);\n    }\n  }\n}\n\nfunction joinSource<TContext, TJoinObject>(\n  this: TContext,\n  withObject: TJoinObject,\n  joinType: JoinTypes = JoinTypes.expand\n): TContext & TJoinObject {\n  if ((joinType | 0b1111) <= 0)\n    throw new Error(\"Invalid join type. Please select join type\");\n\n  if (joinType === (JoinTypes.left | JoinTypes.innerLeft)) {\n    return this as any;\n  }\n\n  let names = getPartNames(this, withObject);\n\n  //merge\n  switch (joinType & JoinTypes.innerJoin) {\n    case JoinTypes.none:\n      clearNames(this, names.middle);\n      break;\n    case JoinTypes.innerLeft:\n      break;\n    case JoinTypes.innerRight:\n      attach(this, withObject, names.middle);\n      break;\n    case JoinTypes.innerJoin:\n      mergeObjects(this, withObject, names.middle);\n      break;\n  }\n\n  //left\n  if ((joinType & JoinTypes.left) !== JoinTypes.left) {\n    clearNames(this, names.left);\n  }\n\n  //right\n  if ((joinType & JoinTypes.right) === JoinTypes.right) {\n    attach(this, withObject, names.right);\n  }\n\n  return this as any;\n}\n\nexport function join(joinType: JoinTypes = JoinTypes.expand) {\n  if (!joinType) {\n    throw new Error('Unknown join type');\n  }\n  return function<TContext>(context: TContext) {\n    return function<TJoinObject>(joinObject: TJoinObject): TContext & TJoinObject {\n      return joinSource.call(context, joinObject, joinType) as TContext & TJoinObject;\n    }\n  }\n}"],"names":["JoinTypes"],"mappings":"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"}